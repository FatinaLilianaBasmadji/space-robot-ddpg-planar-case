#!/usr/bin/env python
# coding: utf-8

# In[1]:


import numpy as np
import tensorflow as tf
import matplotlib.pyplot as plt
from math import cos, sin, exp


# In[2]:


def space_robot_parameters():
    pi = 3.14159
    p1 = 0.3696    # manipulator mounting point in x axis
    p2 = 0.001279  # manipulator mounting point in y axis
    a1 = 0.1805    # center of mass of the first link
    a2 = 0.2000    # center of mass of the second link
    a3 = 0.1029    # center of mass of the third link
    L1 = 0.4488    # the length of the first link
    L2 = 0.4499    # the length of the second link
    L3 = 0.3545    # the length of the third link
    m0 = 64.859    # the mass of the satellite
    m1 = 2.9130    # the mass of the first kinematic pair
    m2 = 2.6460    # the mass of the second kinematic pair
    m3 = 1.6990    # the mass of the third kinematic pair
    I0 = 2.6952    # Satellite moment of inertia
    I1 = 0.091391  # Moment of inertia of the first kinematic pair
    I2 = 0.081375  # Moment of inertia of the second kinematic pair
    I3 = 0.021904  # Moment of inertia of the third kinematic pair
    d  = 0.3536    # Distance from base geometry center to each corner
    params = [p1,p2,a1,a2,a3,L1,L2,L3,m0,m1,m2,m3,I0,I1,I2,I3,d]
    return params


# In[3]:


def reset():
    init_state  = np.array([0, 0, 0, -1.0882, 0.7349, 1.9241, 0, 0, 0, 0, 0, 0])
    return init_state


# In[4]:


def kinematics(state,params):
    p1 = params[0] 
    p2 = params[1] 
    a1 = params[2] 
    a2 = params[3] 
    a3 = params[4] 
    L1 = params[5] 
    L2 = params[6] 
    L3 = params[7] 
    m0 = params[8] 
    m1 = params[9] 
    m2 = params[10] 
    m3 = params[11] 
    I0 = params[12] 
    I1 = params[13] 
    I2 = params[14] 
    I3 = params[15] 
    d  = params[16] 
    EE = np.zeros(3)
    Jacobian = np.zeros((3,6))
    EE[0] = state[0] + p1*cos(state[2]) - p2*sin(state[2]) + L1*cos(state[2]+state[3]) + L2*cos(state[2]+state[3]+state[4]) + L3*cos(state[2]+state[3]+state[4]+state[5]);
    EE[1] = state[1] + p1*sin(state[2]) + p2*cos(state[2]) + L1*sin(state[2]+state[3]) + L2*sin(state[2]+state[3]+state[4]) + L3*sin(state[2]+state[3]+state[4]+state[5]);
    EE[2] = state[2] + state[3] + state[4] + state[5];
    Jacobian[0][0] = 1;
    Jacobian[0][1] = 0;
    Jacobian[0][2] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L1*sin(state[2]+state[3]) - p2*cos(state[2]) - p1*sin(state[2]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][3] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L1*sin(state[2]+state[3]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][4] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][5] = - L3*sin(state[2]+state[3]+state[4]+state[5]);
    Jacobian[1][0] = 0;
    Jacobian[1][1] = 1;
    Jacobian[1][2] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L1*cos(state[2]+state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][3] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L1*cos(state[2]+state[3]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][4] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][5] = L3*cos(state[2]+state[3]+state[4]+state[5]);
    Jacobian[2][0] = 0;
    Jacobian[2][1] = 0;
    Jacobian[2][2] = 1;
    Jacobian[2][3] = 1;
    Jacobian[2][4] = 1;
    Jacobian[2][5] = 1;
    return EE, Jacobian


# In[5]:


def dynamics(state,params):
    p1 = params[0] 
    p2 = params[1] 
    a1 = params[2] 
    a2 = params[3] 
    a3 = params[4] 
    L1 = params[5] 
    L2 = params[6] 
    L3 = params[7] 
    m0 = params[8] 
    m1 = params[9] 
    m2 = params[10] 
    m3 = params[11] 
    I0 = params[12] 
    I1 = params[13] 
    I2 = params[14] 
    I3 = params[15] 
    d  = params[16] 
    J0v = np.zeros((2,6))
    J0w = np.zeros((1,6))
    J1v = np.zeros((2,6))
    J1w = np.zeros((1,6))
    J2v = np.zeros((2,6))
    J2w = np.zeros((1,6))
    J3v = np.zeros((2,6))
    J3w = np.zeros((1,6))
    C = np.zeros((6,1))
    J0v = [[1, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0]]
    J0vt = np.transpose(J0v)
    J0w = [[0, 0, 1, 0, 0, 0]]
    J0wt = np.transpose(J0w)
    var1 = - p1*sin(state[2]) -p2*cos(state[2]) - a1*sin(state[2]+state[3])
    var2 = -a1*sin(state[2]+state[3])
    var3 = -p2*sin(state[2]) + p1*cos(state[2])+a1*cos(state[3]+state[2])
    var4 = a1*cos(state[3]+state[2])
    J1v = [[1, 0, var1, var2, 0, 0],[0, 1, var3, var4, 0, 0]];
    J1vt = np.transpose(J1v)  
    J1w = [[0, 0, 1, 1, 0, 0]]
    J1wt = np.transpose(J1w)
    var5 = -p2*cos(state[2]) - L1*sin(state[3]+state[2]) - p1*sin(state[2]) - a2*sin(state[3]+state[4]+state[2]);
    var6 = -L1*sin(state[3]+state[2]) - a2*sin(state[3]+state[4]+state[2]);
    var7 = -a2*sin(state[3]+state[4]+state[2]);
    var8 = -p2*sin(state[2]) + a2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2])+p1*cos(state[2]);
    var9 =  a2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2]);
    var10 = a2*cos(state[3]+state[4]+state[2]);
    J2v = [[1, 0, var5, var6, var7, 0],[0, 1, var8, var9, var10, 0]]   
    J2vt = np.transpose(J2v)  
    J2w = [[0, 0, 1, 1, 1, 0]]
    J2wt = np.transpose(J2w)
    var11 = -p2*cos(state[2]) - L1*sin(state[3]+state[2]) - p1*sin(state[2]) - L2*sin(state[3]+state[4]+state[2]) -a3*sin(state[2]+state[3]+state[4]+state[5]);
    var12 = -L1*sin(state[3]+state[2]) - L2*sin(state[3]+state[4]+state[2]) - a3*sin(state[3]+state[4]+state[2]+state[5]);
    var13 = -L2*sin(state[3]+state[4]+state[2]) - a3*sin(state[3]+state[4]+state[2]+state[5]);
    var14 = -a3*sin(state[3]+state[4]+state[2]+state[5]);
    var15 = -p2*sin(state[2]) + L2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2])+p1*cos(state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var16 =  L2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var17 =  L2*cos(state[3]+state[4]+state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var18 =  a3*cos(state[2]+state[3]+state[4]+state[5]);
    J3v = [[1, 0, var11, var12, var13, var14],[0, 1, var15, var16, var17, var18]]
    J3vt = np.transpose(J3v)
    J3w = [[0, 0, 1, 1, 1, 1]]
    J3wt = np.transpose(J3w)
    Tv = np.matmul(m0*J0vt,J0v) +  np.matmul(m1*J1vt,J1v) +  np.matmul(m2*J2vt,J2v) +  np.matmul(m3*J3vt,J3v)
    Tw = J0wt*I0*J0w +  J1wt*I1*J1w +  J2wt*I2*J2w + J3wt*I3*J3w;
    M  = Tv+Tw;
    C[0][0] = - state[10]*(state[8]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[9]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[8]*(state[8]*(m2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]))) + state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[9]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[9]*(state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[8]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[9]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[11]*(a3*m3*state[8]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[9]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[10]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5]));
    C[1][0] = - state[11]*(a3*m3*state[8]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[9]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[10]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[8]*(state[9]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + m1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]))) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[9]*(state[8]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[9]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[10]*(state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5]));
    C[2][0] = (state[9]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3]))))/2 - state[8]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1))) - state[6]*(state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2)) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[7]*(state[8]*(m2*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m1*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1)) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + (state[11]*(a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[11]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1))) - state[9]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) - state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 - a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1))) + (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4]))))/2 - state[10]*(state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])))) + (state[8]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]))) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + m1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])))))/2 + (state[6]*(state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2)) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[7]*(state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[8]*(m2*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m1*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1)) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2;
    C[3][0] = (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1))))/2 - state[11]*(state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3)) - state[10]*(state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1))) - (state[8]*(state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) - state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1)) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) - a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 + a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) - state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])))))/2 + (state[6]*(state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[7]*(state[8]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[9]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1))) - state[6]*(state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[7]*(state[8]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) - state[8]*(state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) - a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 + a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])))) + (state[9]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) - state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 - a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1)))/2;
    C[4][0] = (state[8]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) - state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])))))/2 - state[7]*(state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2))) - state[11]**2*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[9]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)) - state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1))))/2 - state[6]*(state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[7]*(state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + state[8]*(state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2)) + (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2)))/2 + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 + (state[6]*(state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 - state[10]*state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2));
    C[5][0] = (state[10]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[9]*(state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])))) + (state[6]*(m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[8] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[9] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[10] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + state[8]*(state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])))) + (state[7]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[8] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[9] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[10] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 - state[6]*(m3*state[8]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[9]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[10]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[8]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[7]*(m3*state[8]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[9]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[10]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 + (state[9]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[10]*state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3);
    return M, C


# In[6]:


def distance(ini_pos, fin_pos):
    L1 = (ini_pos[0]-fin_pos[0])**2 + (ini_pos[1]-fin_pos[1])**2 #+ (ini_pos[2]-fin_pos[2])**2
    L1 = np.sqrt(L1)
    L2 = (ini_pos[2]-fin_pos[2])**2
    L2 = np.sqrt(L2)
    L = [L1,L2]
    return L


# In[1]:


def step(state, action, params, dt, initial_pos, goal_pos, max_action, time, time_act,training):
    H1 = np.zeros((3,3))
    H2 = np.zeros((3,3))
    teta_prim = np.zeros((3,1))
    sat_vel = np.zeros((3,1))
    action = action.numpy()
    joints_velocities_0 = action[0]
    joints_velocities_1 = action[1]
    joints_velocities_2 = action[2]
    x = state
    old_x = x
    old_EE, old_Jacobian = kinematics(x,params)
    q  = np.array([[state[0]], [state[1]], [state[2]], [state[3]], [state[4]], [state[5]]])
    dq = np.array([[state[6]], [state[7]], [state[8]], [state[9]], [state[10]], [state[11]]])
    M, C = dynamics(x,params)
    rsT = [[-state[1], state[0]]]
    Ms_11 = M[0:2,0:2]
    Ms_12 = M[0:2,2]
    Ms_12 = Ms_12.reshape((2, 1))
    MsT_12 = np.transpose(Ms_12)
    Ms_22 = M[2,2]
    H1[0:2,0:2] = Ms_11 
    H1[0:2,2:3] = Ms_12
    H1[2:3,0:2] = MsT_12 + np.matmul(rsT,Ms_11)
    H1[2,2] = Ms_22 + np.matmul(rsT,Ms_12)
    H1inv = np.linalg.inv(H1) 
    Msm_11 = M[0:2,3:6]
    Msm_21 = M[2:3,3:6]
    H2[0:2,0:3] = Msm_11
    H2[2:3,0:3] = Msm_21 + np.matmul(rsT,Msm_11)
    teta_prim = [[joints_velocities_0], [joints_velocities_1], [joints_velocities_2]]
    sat_vel = np.matmul(np.matmul(-H1inv,H2),teta_prim)
    dq = np.vstack([sat_vel,teta_prim])
    k1 = dt*dq
    k2 = dt*(dq + 0.5*k1)
    k3 = dt*(dq + 0.5*k2)
    k4 = dt*(dq + k3)
    q = q + (k1 + 2*k2 + 2*k3 + k4)/6  
    new_x = [q[0], q[1],  q[2],  q[3],  q[4],  q[5], dq[0], dq[1], dq[2], dq[3], dq[4], dq[5]]  
    new_EE, Jacobian = kinematics(new_x, params)
    done = False
    reward = 0
    
    prev_pos = [old_EE[0], old_EE[1], old_EE[2]]
    
    fin_pos = [new_EE[0], new_EE[1], new_EE[2]]
       
    pref_dis = distance(goal_pos, prev_pos)
    act_dis = distance(goal_pos, fin_pos)
       
    #aux = distance(goal_pos, fin_pos)
    #reward -= (0.9*aux[0] + 0.1*aux[1])
    #reward -= aux[0]**2
    
    
    if training == 1:
        # Reward update
        EE_v_x = (new_EE[0]-old_EE[0])/dt
        EE_v_y = (new_EE[1]-old_EE[1])/dt 
        EE_v = np.array([EE_v_x,EE_v_y,0])
        coef_0 = initial_pos
        coef_1 = np.array([0,0,0])
        coef_2 = np.array([0,0,0])
        coef_3 = (1/(2*time**3))*(20*(goal_pos-initial_pos))
        coef_4 = (1/(2*time**4))*(30*(goal_pos-initial_pos))
        coef_5 = (1/(2*time**5))*(12*(goal_pos-initial_pos))
        EE_poly_traj = coef_0 + coef_1*time_act + coef_2*time_act**2 + coef_3*time_act**3 + coef_4*time_act**4 + coef_5*time_act**5
        EE_v_poly_traj = coef_1 + 2*coef_2*time_act + 3*coef_3*time_act**2 + 4*coef_4*time_act**3 + 5*coef_5*time_act**4
        aux1 = distance(fin_pos, EE_poly_traj)
        aux2 = distance(fin_pos, EE_v_poly_traj)
        reward = - 0.8*aux1[0] - 0.2*aux2[0]
        reward = 0
        aux = distance(goal_pos, fin_pos)
        reward -= 10*aux[0]**2
    
    
    
    if abs(goal_pos[0]-new_EE[0])<0.001 and abs(goal_pos[1]-new_EE[1])<0.001:
        done = True
        reward = 1
        
    
    new_x = np.array([q[0], q[1],  q[2],  q[3],  q[4],  q[5], dq[0], dq[1], dq[2], dq[3], dq[4], dq[5]])
    new_x = new_x.reshape(12,)
    return new_x, new_EE, done, reward


# In[ ]:




